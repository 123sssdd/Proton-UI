# MessageInput æ¶ˆæ¯è¾“å…¥æ¡†

ç”¨äºè¾“å…¥å’Œå‘é€æ¶ˆæ¯ï¼Œæ”¯æŒå¿«æ·é”®ï¼ˆEnter å‘é€ï¼ŒShift+Enter æ¢è¡Œï¼‰ã€å­—ç¬¦è®¡æ•°å’ŒåŠ è½½çŠ¶æ€ã€‚

## åŸºç¡€ç”¨æ³•

æœ€ç®€å•çš„æ¶ˆæ¯è¾“å…¥æ¡†ã€‚

<DemoBox
  title="åŸºç¡€æ¶ˆæ¯è¾“å…¥æ¡†"
  description="æ”¯æŒ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ"
  code={`import { MessageInput } from "@proton-ui/core";

export default () => {
  const handleSend = (message) => {
    console.log("å‘é€æ¶ˆæ¯:", message);
  };

return (
<div className="border rounded-lg overflow-hidden">
<MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        onSend={handleSend}
      />
</div>
);
};`}

>

  <div className="border rounded-lg overflow-hidden bg-white">
    <MessageInput
      placeholder="è¾“å…¥æ¶ˆæ¯..."
      onSend={(msg) => console.log("å‘é€:", msg)}
    />
  </div>
</DemoBox>

<Callout type="tip" title="å¿«æ·é”®">
  - **Enter**: å‘é€æ¶ˆæ¯ - **Shift + Enter**: æ¢è¡Œ
</Callout>

## å­—ç¬¦è®¡æ•°

é€šè¿‡ `maxLength` å±æ€§é™åˆ¶è¾“å…¥é•¿åº¦å¹¶æ˜¾ç¤ºå­—ç¬¦è®¡æ•°ã€‚

<DemoBox
  title="å­—ç¬¦è®¡æ•°"
  description="é™åˆ¶æœ€å¤š 100 ä¸ªå­—ç¬¦"
  code={`import { MessageInput } from "@proton-ui/core";

export default () => {
  return (
    <div className="border rounded-lg overflow-hidden">
      <MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯ï¼ˆæœ€å¤š 100 å­—ï¼‰..."
        maxLength={100}
        onSend={(msg) => console.log("å‘é€:", msg)}
      />
    </div>
  );
};`}
>
  <div className="border rounded-lg overflow-hidden bg-white">
    <MessageInput
      placeholder="è¾“å…¥æ¶ˆæ¯ï¼ˆæœ€å¤š 100 å­—ï¼‰..."
      maxLength={100}
      onSend={(msg) => console.log("å‘é€:", msg)}
    />
  </div>
</DemoBox>

## åŠ è½½çŠ¶æ€

å‘é€æ¶ˆæ¯æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤å‘é€ã€‚

<DemoBox
  title="åŠ è½½çŠ¶æ€"
  description="å‘é€æŒ‰é’®æ˜¾ç¤ºåŠ è½½åŠ¨ç”»"
  code={`import { MessageInput } from "@proton-ui/core";
import { useState } from "react";

export default () => {
  const [loading, setLoading] = useState(false);

const handleSend = (message) => {
setLoading(true);
// æ¨¡æ‹Ÿå‘é€
setTimeout(() => {
console.log("å‘é€:", message);
setLoading(false);
}, 2000);
};

return (
<div className="border rounded-lg overflow-hidden">
<MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        loading={loading}
        onSend={handleSend}
      />
</div>
);
};`}

>

  <div className="border rounded-lg overflow-hidden bg-white">
    <MessageInput
      placeholder="è¯•è¯•å‘é€æ¶ˆæ¯..."
      loading={false}
      onSend={(msg) => {
        console.log("å‘é€:", msg);
        alert(`å‘é€æ¶ˆæ¯: ${msg}`);
      }}
    />
  </div>
</DemoBox>

## ç¦ç”¨çŠ¶æ€

ç¦ç”¨è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®ã€‚

<DemoBox
  title="ç¦ç”¨çŠ¶æ€"
  code={`import { MessageInput } from "@proton-ui/core";

export default () => {
  return (
    <div className="border rounded-lg overflow-hidden">
      <MessageInput
        placeholder="è¾“å…¥æ¡†å·²ç¦ç”¨"
        disabled
        onSend={(msg) => console.log("å‘é€:", msg)}
      />
    </div>
  );
};`}
>
  <div className="border rounded-lg overflow-hidden bg-white">
    <MessageInput
      placeholder="è¾“å…¥æ¡†å·²ç¦ç”¨"
      disabled
      onSend={(msg) => console.log("å‘é€:", msg)}
    />
  </div>
</DemoBox>

## å®Œæ•´ç¤ºä¾‹

ç»“åˆæ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´å¯¹è¯ç¤ºä¾‹ã€‚

<DemoBox
  title="å®Œæ•´å¯¹è¯ç¤ºä¾‹"
  description="åŒ…å«æ¶ˆæ¯åˆ—è¡¨ã€è¾“å…¥æ¡†ã€åŠ è½½çŠ¶æ€"
  code={`import { MessageInput } from "@proton-ui/core";
import { useState } from "react";

export default () => {
  const [messages, setMessages] = useState([]);
  const [loading, setLoading] = useState(false);

const handleSend = (message) => {
setMessages((prev) => [...prev, \`ä½ : \${message}\`]);

    // æ¨¡æ‹Ÿ AI å›å¤
    setLoading(true);
    setTimeout(() => {
      setMessages((prev) => [...prev, \`AI: æ”¶åˆ°ä½ çš„æ¶ˆæ¯"\${message}"\`]);
      setLoading(false);
    }, 1000);

};

return (
<div className="border rounded-lg overflow-hidden bg-white">
{/* æ¶ˆæ¯åˆ—è¡¨ */}
<div className="h-48 overflow-y-auto p-4 space-y-2 bg-gray-50">
{messages.length === 0 ? (
<p className="text-sm text-gray-400 text-center py-8">
è¿˜æ²¡æœ‰æ¶ˆæ¯ï¼Œè¯•è¯•å‘é€ä¸€æ¡å§ï¼
</p>
) : (
messages.map((msg, index) => (
<div
key={index}
className={\`text-sm p-2 rounded \${
msg.startsWith("ä½ :")
? "bg-blue-100 text-blue-900 ml-auto max-w-xs"
: "bg-white text-gray-900 mr-auto max-w-xs"
}\`} >
{msg}
</div>
))
)}
</div>
{/* è¾“å…¥æ¡† */}
<MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        loading={loading}
        onSend={handleSend}
      />
</div>
);
};`}

>

  <MessageInputDemo />
</DemoBox>

## è‡ªå®šä¹‰æŒ‰é’®æ–‡æœ¬

å¯ä»¥è‡ªå®šä¹‰å‘é€æŒ‰é’®çš„æ–‡æœ¬ã€‚

<DemoBox
  title="è‡ªå®šä¹‰æŒ‰é’®æ–‡æœ¬"
  code={`import { MessageInput } from "@proton-ui/core";

export default () => {
  return (
    <div className="space-y-4">
      <div className="border rounded-lg overflow-hidden">
        <MessageInput
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          sendButtonText="å‘é€"
          onSend={(msg) => console.log(msg)}
        />
      </div>
      <div className="border rounded-lg overflow-hidden">
        <MessageInput
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          sendButtonText="æäº¤"
          onSend={(msg) => console.log(msg)}
        />
      </div>
      <div className="border rounded-lg overflow-hidden">
        <MessageInput
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          sendButtonText="â†’"
          onSend={(msg) => console.log(msg)}
        />
      </div>
    </div>
  );
};`}
>
  <div className="space-y-4">
    <div className="border rounded-lg overflow-hidden bg-white">
      <MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        sendButtonText="å‘é€"
        onSend={(msg) => console.log(msg)}
      />
    </div>
    <div className="border rounded-lg overflow-hidden bg-white">
      <MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        sendButtonText="æäº¤"
        onSend={(msg) => console.log(msg)}
      />
    </div>
    <div className="border rounded-lg overflow-hidden bg-white">
      <MessageInput
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        sendButtonText="â†’"
        onSend={(msg) => console.log(msg)}
      />
    </div>
  </div>
</DemoBox>

## API

### MessageInput Props

<PropsTable
  data={[
    {
      name: "placeholder",
      type: "string",
      required: false,
      defaultValue: '"è¾“å…¥æ¶ˆæ¯..."',
      description: "è¾“å…¥æ¡†å ä½ç¬¦æ–‡æœ¬",
    },
    {
      name: "sendButtonText",
      type: "string",
      required: false,
      defaultValue: '"å‘é€"',
      description: "å‘é€æŒ‰é’®æ–‡æœ¬",
    },
    {
      name: "disabled",
      type: "boolean",
      required: false,
      defaultValue: "false",
      description: "æ˜¯å¦ç¦ç”¨è¾“å…¥æ¡†å’ŒæŒ‰é’®",
    },
    {
      name: "loading",
      type: "boolean",
      required: false,
      defaultValue: "false",
      description: "æ˜¯å¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€",
    },
    {
      name: "maxLength",
      type: "number",
      required: false,
      description: "æœ€å¤§å­—ç¬¦æ•°ï¼Œè®¾ç½®åä¼šæ˜¾ç¤ºå­—ç¬¦è®¡æ•°",
    },
    {
      name: "onSend",
      type: "(message: string) => void",
      required: false,
      description: "å‘é€æ¶ˆæ¯å›è°ƒå‡½æ•°",
    },
    {
      name: "onChange",
      type: "(value: string) => void",
      required: false,
      description: "è¾“å…¥å†…å®¹å˜åŒ–å›è°ƒå‡½æ•°",
    },
    {
      name: "className",
      type: "string",
      required: false,
      description: "è‡ªå®šä¹‰å®¹å™¨ç±»å",
    },
  ]}
/>

## ä½¿ç”¨åœºæ™¯

### 1. AI å¯¹è¯ç•Œé¢

```tsx
import { MessageInput, ChatContainer } from "@proton-ui/core";
import { useState } from "react";

export default function ChatApp() {
  const [messages, setMessages] = useState([]);
  const [loading, setLoading] = useState(false);

  const handleSend = async (message) => {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    setMessages((prev) => [
      ...prev,
      { id: Date.now(), role: "user", content: message },
    ]);

    // è°ƒç”¨ AI API
    setLoading(true);
    const response = await fetch("/api/chat", {
      method: "POST",
      body: JSON.stringify({ message }),
    });
    const data = await response.json();

    // æ·»åŠ  AI å›å¤
    setMessages((prev) => [
      ...prev,
      { id: Date.now() + 1, role: "assistant", content: data.reply },
    ]);
    setLoading(false);
  };

  return (
    <div className="h-screen flex flex-col">
      <div className="flex-1 overflow-hidden">
        <ChatContainer messages={messages} loading={loading} />
      </div>
      <MessageInput onSend={handleSend} loading={loading} />
    </div>
  );
}
```

### 2. è¡¨å•æäº¤

```tsx
import { MessageInput } from "@proton-ui/core";
import { useState } from "react";

export default function FeedbackForm() {
  const [submitting, setSubmitting] = useState(false);

  const handleSubmit = async (feedback) => {
    setSubmitting(true);
    await fetch("/api/feedback", {
      method: "POST",
      body: JSON.stringify({ feedback }),
    });
    setSubmitting(false);
    alert("åé¦ˆå·²æäº¤ï¼");
  };

  return (
    <div className="max-w-2xl mx-auto">
      <h2 className="text-xl font-bold mb-4">æäº¤åé¦ˆ</h2>
      <MessageInput
        placeholder="è¯·è¾“å…¥æ‚¨çš„åé¦ˆ..."
        sendButtonText="æäº¤"
        maxLength={500}
        loading={submitting}
        onSend={handleSubmit}
      />
    </div>
  );
}
```

### 3. è¯„è®ºç³»ç»Ÿ

```tsx
import { MessageInput } from "@proton-ui/core";
import { useState } from "react";

export default function CommentSection() {
  const [comments, setComments] = useState([]);

  const handleComment = (content) => {
    const newComment = {
      id: Date.now(),
      author: "å½“å‰ç”¨æˆ·",
      content,
      timestamp: new Date(),
    };
    setComments((prev) => [...prev, newComment]);
  };

  return (
    <div>
      <h3 className="text-lg font-bold mb-4">è¯„è®º</h3>
      <div className="space-y-4 mb-4">
        {comments.map((comment) => (
          <div key={comment.id} className="border-l-4 border-blue-500 pl-4">
            <p className="font-medium">{comment.author}</p>
            <p className="text-gray-700">{comment.content}</p>
            <p className="text-xs text-gray-500">
              {comment.timestamp.toLocaleString()}
            </p>
          </div>
        ))}
      </div>
      <MessageInput
        placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
        sendButtonText="å‘è¡¨è¯„è®º"
        onSend={handleComment}
      />
    </div>
  );
}
```

## æ— éšœç¢è®¿é—®

MessageInput ç»„ä»¶éµå¾ªæ— éšœç¢è®¿é—®æœ€ä½³å®è·µï¼š

### ARIA å±æ€§

- è¾“å…¥æ¡†ä½¿ç”¨ `aria-label` æè¿°ç”¨é€”
- å­—ç¬¦è®¡æ•°ä½¿ç”¨ `aria-live="polite"` å®æ—¶æ’­æŠ¥
- å‘é€æŒ‰é’®ä½¿ç”¨ `aria-label` æè¿°æ“ä½œ

### é”®ç›˜å¯¼èˆª

- **Tab**: åœ¨è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¹‹é—´åˆ‡æ¢ç„¦ç‚¹
- **Enter**: å‘é€æ¶ˆæ¯
- **Shift + Enter**: åœ¨è¾“å…¥æ¡†ä¸­æ¢è¡Œ
- **Space**: æ¿€æ´»å‘é€æŒ‰é’®ï¼ˆå½“æŒ‰é’®è·å¾—ç„¦ç‚¹æ—¶ï¼‰

### çŠ¶æ€åé¦ˆ

- ç¦ç”¨çŠ¶æ€ä½¿ç”¨ `disabled` å±æ€§å’Œè§†è§‰æ ·å¼
- åŠ è½½çŠ¶æ€åœ¨æŒ‰é’®ä¸Šæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- å­—ç¬¦è®¡æ•°å®æ—¶æ›´æ–°å¹¶æ’­æŠ¥

<Callout type="info" title="å±å¹•é˜…è¯»å™¨">
  MessageInput å¯¹å±å¹•é˜…è¯»å™¨å‹å¥½ï¼Œä¼šæ­£ç¡®æ’­æŠ¥è¾“å…¥æ¡†çŠ¶æ€ã€å­—ç¬¦è®¡æ•°å’ŒæŒ‰é’®çŠ¶æ€ã€‚
</Callout>

## æœ€ä½³å®è·µ

### 1. é˜²æ­¢ç©ºæ¶ˆæ¯

ç»„ä»¶å†…ç½®äº†ç©ºæ¶ˆæ¯æ£€æµ‹ï¼Œåªæœ‰éç©ºæ¶ˆæ¯æ‰èƒ½å‘é€ï¼š

```tsx
<MessageInput
  onSend={(message) => {
    // message å·²ç»è¿‡ trim() å¤„ç†ï¼Œä¸ä¼šæ˜¯ç©ºå­—ç¬¦ä¸²
    console.log("å‘é€:", message);
  }}
/>
```

### 2. åŠ è½½çŠ¶æ€ç®¡ç†

å‘é€æ¶ˆæ¯æ—¶è®¾ç½®åŠ è½½çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤å‘é€ï¼š

```tsx
const [loading, setLoading] = useState(false);

const handleSend = async (message) => {
  setLoading(true);
  try {
    await sendMessageToAPI(message);
  } finally {
    setLoading(false);
  }
};

<MessageInput loading={loading} onSend={handleSend} />;
```

### 3. å­—ç¬¦é™åˆ¶

å¯¹äºæœ‰é•¿åº¦é™åˆ¶çš„åœºæ™¯ï¼Œä½¿ç”¨ `maxLength`ï¼š

```tsx
<MessageInput maxLength={500} onSend={handleSend} />
```

### 4. è¾“å…¥ç›‘å¬

ä½¿ç”¨ `onChange` ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œå®ç°å®æ—¶åŠŸèƒ½ï¼š

```tsx
const [isTyping, setIsTyping] = useState(false);

<MessageInput
  onChange={(value) => {
    setIsTyping(value.length > 0);
    // å‘é€"æ­£åœ¨è¾“å…¥"çŠ¶æ€åˆ°æœåŠ¡å™¨
    socket.emit("typing", { isTyping: value.length > 0 });
  }}
  onSend={handleSend}
/>;
```

## è®¾è®¡ä»¤ç‰Œ

MessageInput ä½¿ç”¨ä»¥ä¸‹ CSS å˜é‡ï¼š

- è¾¹æ¡†é¢œè‰²ï¼š`border-gray-200` / `dark:border-gray-700`
- èƒŒæ™¯è‰²ï¼š`bg-white` / `dark:bg-gray-900`
- è¾“å…¥æ¡†èƒŒæ™¯ï¼š`bg-white` / `dark:bg-gray-800`
- æ–‡æœ¬é¢œè‰²ï¼š`text-gray-900` / `dark:text-gray-100`
- å ä½ç¬¦é¢œè‰²ï¼š`text-gray-400` / `dark:text-gray-500`
- ç„¦ç‚¹ç¯ï¼š`ring-blue-500`

## ç›¸å…³ç»„ä»¶

- [ChatContainer](/components/chat/chat-container) - å¯¹è¯å®¹å™¨
- [Message](/components/chat/message) - æ¶ˆæ¯ç»„ä»¶
- [Button](/components/button) - æŒ‰é’®ç»„ä»¶

## å¸¸è§é—®é¢˜

### å¦‚ä½•å®ç°è‡ªåŠ¨èšç„¦ï¼Ÿ

ä½¿ç”¨ ref æ§åˆ¶è¾“å…¥æ¡†ç„¦ç‚¹ï¼š

```tsx
import { useRef, useEffect } from "react";

const inputRef = useRef(null);

useEffect(() => {
  inputRef.current?.focus();
}, []);

// æ³¨æ„ï¼šMessageInput ç›®å‰ä¸æ”¯æŒ refï¼Œéœ€è¦è‡ªå·±å®ç°æˆ–æäº¤ PR
```

### å¦‚ä½•å®ç°å¤šè¡Œè¾“å…¥ï¼Ÿ

MessageInput çš„ textarea ä¼šè‡ªåŠ¨æ ¹æ®å†…å®¹è°ƒæ•´é«˜åº¦ã€‚ä½¿ç”¨ Shift+Enter å¯ä»¥æ¢è¡Œã€‚

### å¦‚ä½•å®ç°è¾“å…¥å»ºè®®ï¼Ÿ

å¯ä»¥åœ¨ MessageInput ä¸Šæ–¹æ·»åŠ å»ºè®®åˆ—è¡¨ï¼š

```tsx
<div className="relative">
  {suggestions.length > 0 && (
    <div className="absolute bottom-full mb-2 w-full bg-white border rounded-lg shadow-lg">
      {suggestions.map((suggestion) => (
        <button
          key={suggestion}
          onClick={() => handleSelectSuggestion(suggestion)}
          className="w-full text-left px-4 py-2 hover:bg-gray-100"
        >
          {suggestion}
        </button>
      ))}
    </div>
  )}
  <MessageInput onSend={handleSend} />
</div>
```

### å¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

å¯ä»¥åœ¨ MessageInput æ—è¾¹æ·»åŠ æ–‡ä»¶ä¸Šä¼ æŒ‰é’®ï¼š

```tsx
<div className="flex gap-2 p-4 border-t">
  <input
    type="file"
    ref={fileInputRef}
    className="hidden"
    onChange={handleFileSelect}
  />
  <button
    onClick={() => fileInputRef.current?.click()}
    className="px-3 py-2 border rounded-lg hover:bg-gray-50"
  >
    ğŸ“
  </button>
  <MessageInput onSend={handleSend} className="flex-1" />
</div>
```
